# Story 8.5.1: Angular Material Theme Migration

Status: done

## Story

As a user,
I want the application to use the new Upkeep color palette,
so that I experience a fresh, modern, and cohesive visual design.

## Acceptance Criteria

1. **Given** I open the application, **When** I view any page, **Then** I see the new cobalt blue (#4361ee) as the primary color

2. **And** purple (#7c3aed) appears as accent/secondary color

3. **And** teal (#0d9488) is used for success states

4. **And** terracotta (#c2784e) is used for warm accent elements

5. **Given** I view the content area (main body), **When** I look at the background, **Then** I see a subtle gradient from light lavender (#eef2ff) at the bottom fading to white at the top

6. **Given** I use any Angular Material component (buttons, cards, forms), **When** they are rendered, **Then** they use the new theme colors consistently

## Tasks / Subtasks

- [x] Task 1: Generate M3 color palettes (AC: #1, #2, #3)
  - [x] 1.1 Run `ng generate @angular/material:m3-theme --primary-color=#4361ee --tertiary-color=#0d9488 --directory=src/styles`
  - [x] 1.2 Verify `_theme-colors.scss` is generated with tonal values

- [x] Task 2: Update styles.scss theme configuration (AC: #1, #2, #3, #6)
  - [x] 2.1 Replace Forest Green palette imports with new Upkeep theme
  - [x] 2.2 Add Inter font to typography configuration
  - [x] 2.3 Update `html` mat.theme() include with new palettes

- [x] Task 3: Update CSS custom properties (AC: #1, #2, #3, #4)
  - [x] 3.1 Replace all `--pm-*` variables with new color values per design spec
  - [x] 3.2 Update sidebar active state variables to use Upkeep Blue
  - [x] 3.3 Update text color variables
  - [x] 3.4 Update link colors to use primary

- [x] Task 4: Add background gradient to content area (AC: #5)
  - [x] 4.1 Add gradient CSS for main content area (shell.component.scss)
  - [x] 4.2 Ensure gradient works with existing layout

- [x] Task 5: Update index.html (AC: #6)
  - [x] 5.1 Add Inter font from Google Fonts (preconnect + stylesheet)

- [x] Task 6: Visual verification (AC: #1-6)
  - [x] 6.1 Verify all Angular Material buttons use new primary color
  - [x] 6.2 Verify form fields focus states use new colors
  - [x] 6.3 Verify cards, dialogs, and snackbars render correctly
  - [x] 6.4 Verify gradient background displays properly
  - [x] 6.5 Screenshot verification on Dashboard, Properties, Vendors pages

## Dev Notes

### Critical Architecture Constraints

- **Framework:** Angular 20 with Angular Material 20.x [Source: architecture.md]
- **State Management:** @ngrx/signals (not affected by this story)
- **Styling:** SCSS with Angular Material theming system [Source: architecture.md]
- **Testing:** Vitest for unit/component tests [Source: architecture.md]

### Implementation Approach

This story focuses ONLY on the Angular Material theme and CSS custom properties. Sidebar styling (8.5.2) and logo/favicon (8.5.3) are separate stories.

**Key Decision:** Use Angular Material's M3 (Material 3) theming schematic which generates tonal palettes automatically from seed colors.

### Color Palette Reference

| Role | Hex | Variable |
|------|-----|----------|
| Primary (Cobalt) | #4361ee | `--pm-primary` |
| Primary Dark | #3651d4 | `--pm-primary-dark` |
| Primary Light | #6b8cff | `--pm-primary-light` |
| Secondary (Violet) | #7c3aed | `--pm-secondary` |
| Success (Teal) | #0d9488 | `--pm-success` |
| Warm (Terracotta) | #c2784e | `--pm-warm` |
| Warning | #d97706 | `--pm-warning` |
| Error | #dc2626 | `--pm-error` |
| Sidebar BG | #1e2340 | `--pm-sidebar-bg` |
| Text Primary | #0f172a | `--pm-text-primary` |
| Text Secondary | #475569 | `--pm-text-secondary` |
| Background | #ffffff | `--pm-background` |
| Gradient Start | #eef2ff | `--pm-gradient-start` |

[Source: ux-design-refresh-2026.md Section 2]

### Current State Analysis

**File:** `frontend/src/styles.scss` (340 lines)

Current theme uses:
- `$forest-green-palette` - Primary (#66BB6A)
- `$warm-orange-palette` - Tertiary (#FFA726)
- System fonts (no Inter)
- Flat background (#FAFAFA)

**What changes:**
- Replace entire palette definition with generated M3 palettes
- Update `:root` CSS variables
- Add Inter font to typography config
- Add gradient to body/content area

**What stays the same:**
- Dialog panel classes (.confirm-dialog-panel, .receipt-lightbox-panel, .year-selector-panel)
- Shadow override pattern
- Basic link styling (update colors only)

### Project Structure Notes

**Files to modify:**
```
frontend/
├── src/
│   ├── index.html          # Add Inter font, update title
│   ├── styles.scss         # Main theme file - major changes
│   └── styles/
│       └── _theme-colors.scss  # NEW - generated by schematic
```

**Files NOT touched in this story:**
- Sidebar component (story 8.5.2)
- Logo/favicon assets (story 8.5.3)
- Individual component styles (story 8.5.5)

### Technical Requirements

1. **Angular Material Schematic:**
   ```bash
   cd frontend
   ng generate @angular/material:theme-color \
     --primaryColor=#4361ee \
     --tertiaryColor=#0d9488 \
     --directory=src/styles
   ```
   This generates `src/styles/_theme-colors.scss` with M3 tonal values.

2. **Inter Font Integration:**
   ```html
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
   ```

3. **Background Gradient CSS:**
   ```scss
   .main-content,
   .shell-content {
     background: linear-gradient(
       to top,
       var(--pm-gradient-start) 0%,
       #f8faff 30%,
       var(--pm-background) 70%
     );
   }
   ```

4. **Typography Configuration:**
   ```scss
   typography: (
     plain-family: ('Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif),
     brand-family: ('Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif),
   ),
   ```

### Testing Requirements

- **Visual regression:** Compare screenshots before/after on:
  - Dashboard
  - Properties list
  - Expense form
  - Login page

- **Component check:** Ensure Angular Material components render correctly:
  - mat-button (primary, secondary variants)
  - mat-form-field (focus states)
  - mat-card (shadows, borders)
  - mat-snackbar (success, error states)
  - mat-dialog (styling)

- **Run existing tests:** `npm test` should pass (no functional changes)

### References

- [Source: ux-design-refresh-2026.md#2-color-system] - Complete color palette
- [Source: ux-design-refresh-2026.md#6-implementation-guide] - Step-by-step implementation
- [Source: ux-design-refresh-2026.md#8-migration-checklist] - Verification checklist
- [Source: architecture.md#technology-stack-details] - Angular 20 + Angular Material 20.x
- [Source: styles.scss] - Current theme configuration (340 lines)

### Out of Scope

- Sidebar styling changes (story 8.5.2)
- Logo and favicon implementation (story 8.5.3)
- Receipt lightbox fix (story 8.5.4)
- Component-by-component color audit (story 8.5.5)

### Definition of Done

- [x] M3 theme palettes generated and applied
- [x] All `--pm-*` CSS variables updated to new colors
- [x] Inter font loading from Google Fonts
- [x] Background gradient applied to content area
- [x] Visual verification on major screens
- [x] Existing tests pass (`npm test`) - 928/928 passing
- [x] No console errors related to styling
- [x] PR #92 merged to main

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

N/A

### Completion Notes List

- Used `ng generate @angular/material:m3-theme` schematic (not theme-color as originally specified)
- Schematic arguments use kebab-case (--primary-color vs --primaryColor)
- Page title change to "Upkeep" deferred to story 8.5.3 (logo/branding story)
- Build warning about bundle size (621KB vs 550KB budget) is pre-existing, not related to this story

### File List

- `frontend/src/styles/_theme-colors.scss` (NEW) - Generated M3 palettes
- `frontend/src/styles.scss` - Theme configuration update
- `frontend/src/index.html` - Inter font integration
- `frontend/src/app/core/components/shell/shell.component.scss` - Background gradient

