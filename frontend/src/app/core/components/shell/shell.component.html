<mat-sidenav-container class="shell-container">
  <!-- Sidebar Navigation - Desktop (always visible) & Tablet (collapsible) -->
  @if (showSidebar()) {
    <mat-sidenav
      #sidenav
      [mode]="sidebarMode()"
      [opened]="sidebarOpened()"
      (closedStart)="closeSidebar()"
      class="shell-sidenav"
      [fixedInViewport]="true"
    >
      <app-sidebar-nav />
    </mat-sidenav>
  }

  <!-- Main Content Area (AC7.3) -->
  <mat-sidenav-content class="shell-content" [class.with-bottom-nav]="showBottomNav()">
    <!-- Tablet Header with Hamburger Menu -->
    @if (showMenuButton()) {
      <mat-toolbar class="tablet-header" color="primary">
        <button
          mat-icon-button
          (click)="toggleSidebar()"
          aria-label="Toggle menu"
          data-testid="menu-toggle-button"
        >
          <mat-icon>menu</mat-icon>
        </button>
        <span class="header-title">Upkeep</span>
        <span class="spacer"></span>
        <app-year-selector class="light-theme" />
        <span class="user-name" data-testid="tablet-user-name">{{ userDisplayName }}</span>
        <button
          mat-icon-button
          (click)="logout()"
          [disabled]="isLoggingOut()"
          aria-label="Logout"
          [attr.aria-busy]="isLoggingOut()"
          data-testid="tablet-logout-button"
        >
          @if (isLoggingOut()) {
            <mat-spinner diameter="20"></mat-spinner>
          } @else {
            <mat-icon>logout</mat-icon>
          }
        </button>
      </mat-toolbar>
    }

    <!-- Mobile Header with Year Selector (AC-3.5.1) and Logout (AC-7.1.1) -->
    @if (showBottomNav()) {
      <mat-toolbar class="mobile-header" color="primary">
        <span class="header-title">Upkeep</span>
        <span class="spacer"></span>
        <app-year-selector />
        <span class="user-name" data-testid="mobile-user-name">{{ userDisplayName }}</span>
        <button
          mat-icon-button
          (click)="logout()"
          [disabled]="isLoggingOut()"
          aria-label="Logout"
          [attr.aria-busy]="isLoggingOut()"
          data-testid="mobile-logout-button"
        >
          @if (isLoggingOut()) {
            <mat-spinner diameter="20"></mat-spinner>
          } @else {
            <mat-icon>logout</mat-icon>
          }
        </button>
      </mat-toolbar>
    }

    <main class="content-area" [class.with-tablet-header]="showMenuButton()" [class.with-mobile-header]="showBottomNav()">
      <router-outlet />
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>

<!-- Mobile Bottom Navigation (AC7.5) -->
@if (showBottomNav()) {
  <app-bottom-nav />
}

<!-- Mobile Receipt Capture FAB (AC-5.2.1) -->
<app-mobile-capture-fab />
