<div class="property-form-container">
  <mat-card class="property-form-card">
    <mat-card-header>
      <mat-card-title>Add Property</mat-card-title>
      <mat-card-subtitle>Enter property details</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        @if (serverErrors()['general']) {
          <div class="server-error">
            {{ serverErrors()['general'][0] }}
          </div>
        }

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Property Name</mat-label>
          <input matInput formControlName="name" placeholder="e.g., Oak Street Duplex">
          @if (form.get('name')?.hasError('required') && form.get('name')?.touched) {
            <mat-error>Property name is required</mat-error>
          }
          @if (form.get('name')?.hasError('maxlength') && form.get('name')?.touched) {
            <mat-error>Name must be 255 characters or less</mat-error>
          }
          @if (getServerError('name') || getServerError('Name')) {
            <mat-error>{{ getServerError('name') || getServerError('Name') }}</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Street Address</mat-label>
          <input matInput formControlName="street" placeholder="e.g., 123 Oak Street">
          @if (form.get('street')?.hasError('required') && form.get('street')?.touched) {
            <mat-error>Street address is required</mat-error>
          }
          @if (form.get('street')?.hasError('maxlength') && form.get('street')?.touched) {
            <mat-error>Street must be 255 characters or less</mat-error>
          }
          @if (getServerError('street') || getServerError('Street')) {
            <mat-error>{{ getServerError('street') || getServerError('Street') }}</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>City</mat-label>
          <input matInput formControlName="city" placeholder="e.g., Austin">
          @if (form.get('city')?.hasError('required') && form.get('city')?.touched) {
            <mat-error>City is required</mat-error>
          }
          @if (form.get('city')?.hasError('maxlength') && form.get('city')?.touched) {
            <mat-error>City must be 100 characters or less</mat-error>
          }
          @if (getServerError('city') || getServerError('City')) {
            <mat-error>{{ getServerError('city') || getServerError('City') }}</mat-error>
          }
        </mat-form-field>

        <div class="address-row">
          <mat-form-field appearance="outline" class="state-field">
            <mat-label>State</mat-label>
            <mat-select formControlName="state">
              @for (state of states; track state.code) {
                <mat-option [value]="state.code">{{ state.name }}</mat-option>
              }
            </mat-select>
            @if (form.get('state')?.hasError('required') && form.get('state')?.touched) {
              <mat-error>State is required</mat-error>
            }
            @if (getServerError('state') || getServerError('State')) {
              <mat-error>{{ getServerError('state') || getServerError('State') }}</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="zip-field">
            <mat-label>ZIP Code</mat-label>
            <input matInput formControlName="zipCode" placeholder="e.g., 78701" maxlength="5">
            @if (form.get('zipCode')?.hasError('required') && form.get('zipCode')?.touched) {
              <mat-error>ZIP Code is required</mat-error>
            }
            @if (form.get('zipCode')?.hasError('pattern') && form.get('zipCode')?.touched) {
              <mat-error>ZIP Code must be exactly 5 digits</mat-error>
            }
            @if (getServerError('zipCode') || getServerError('ZipCode')) {
              <mat-error>{{ getServerError('zipCode') || getServerError('ZipCode') }}</mat-error>
            }
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button mat-button type="button" (click)="cancel()" [disabled]="loading()">
            Cancel
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading()">
            @if (loading()) {
              <mat-spinner diameter="20"></mat-spinner>
            } @else {
              Save Property
            }
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
